# ğŸ—‚ï¸ Diagramme d'Architecture de Stockage

## Vue d'ensemble globale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NAVIGATEUR CLIENT                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    IndexedDB (gmao_client_db)                â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚  documents  â”‚  â”‚ embeddings  â”‚  â”‚ chat_historyâ”‚         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  â”‚
â”‚  â”‚  â”‚ Fichier PDF â”‚  â”‚ Chunks +    â”‚  â”‚ Conversationâ”‚         â”‚  â”‚
â”‚  â”‚  â”‚ DOCX, TXT   â”‚  â”‚ Vecteurs    â”‚  â”‚ messages    â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ Texte brut  â”‚  â”‚ (Cohere)    â”‚  â”‚             â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ equipment   â”‚  â”‚ maintenance â”‚  â”‚    parts    â”‚         â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  â”‚
â”‚  â”‚  â”‚ Ã‰quipements â”‚  â”‚ Interventns â”‚  â”‚ PiÃ¨ces (PDR)â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ ParsÃ©s      â”‚  â”‚ ParsÃ©es     â”‚  â”‚ ParsÃ©es     â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ StructurÃ©s  â”‚  â”‚ StructurÃ©es â”‚  â”‚ StructurÃ©es â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
                         (Optionnel - Supabase)
                          Upload fichiers bruts
```

---

## Flux de traitement dÃ©taillÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER UPLOAD   â”‚  File: equipment.pdf
â”‚   FILE (.pdf)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  1. UPLOAD STORAGE                     â”‚
    â”‚  uploadDocument(file, userId)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  documents STORE                        â”‚
    â”‚  â”œâ”€ id: "uuid-doc-1"                   â”‚
    â”‚  â”œâ”€ fileName: "equipment.pdf"          â”‚
    â”‚  â”œâ”€ fileData: ArrayBuffer[]            â”‚
    â”‚  â”œâ”€ textContent: ""                    â”‚
    â”‚  â”œâ”€ processed: false                   â”‚
    â”‚  â””â”€ userId: "user-123"                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2. EXTRACT TEXT                 â”‚
    â”‚  extractText(file)               â”‚
    â”‚  â”œâ”€ PDF â†’ pdfjs-dist extraction  â”‚
    â”‚  â”œâ”€ DOCX â†’ mammoth extraction    â”‚
    â”‚  â””â”€ TXT â†’ read as text           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  documents STORE (updated)              â”‚
    â”‚  â”œâ”€ id: "uuid-doc-1"                   â”‚
    â”‚  â”œâ”€ textContent: "Code_Equip: EQ001... â”‚
    â”‚  â”‚                Nom_Equipement:..."  â”‚
    â”‚  â””â”€ processed: false                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  3. CLASSIFICATION                     â”‚
    â”‚  classifyTextClient(text)              â”‚
    â”‚  Cherche keywords:                     â”‚
    â”‚  â”œâ”€ "Ã©quipement" â†’ EQUIPMENT âœ“        â”‚
    â”‚  â”œâ”€ "panne" â†’ MAINTENANCE             â”‚
    â”‚  â””â”€ "piÃ¨ce" â†’ PARTS                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“ TYPE: "equipment"
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. PARSING FIELDS                     â”‚
    â”‚  parseFieldsClient(text, cols)         â”‚
    â”‚  Regex + fallback patterns:            â”‚
    â”‚  â”œâ”€ "Code_Equip:" â†’ "EQ001" âœ“        â”‚
    â”‚  â”œâ”€ "Nom_Equipement:" â†’ "Comp..." âœ“  â”‚
    â”‚  â”œâ”€ "Type:" â†’ "Industriel" âœ“         â”‚
    â”‚  â””â”€ (autres champs)                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  equipment STORE (NEW RECORD)           â”‚
    â”‚  â”œâ”€ id: "uuid-eq-1"                    â”‚
    â”‚  â”œâ”€ userId: "user-123"                 â”‚
    â”‚  â”œâ”€ source_document_id: "uuid-doc-1"   â”‚
    â”‚  â”œâ”€ Code_Equip: "EQ001"                â”‚
    â”‚  â”œâ”€ Nom_Equipement: "Compresseur"      â”‚
    â”‚  â”œâ”€ Type: "Industriel"                 â”‚
    â”‚  â””â”€ ...                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“ (Si Cohere API key prÃ©sente)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5. TEXT CHUNKING & EMBEDDING      â”‚
    â”‚  â”œâ”€ chunkText(text) â†’ 10 chunks    â”‚
    â”‚  â”œâ”€ cohere.embed(chunks)           â”‚
    â”‚  â””â”€ Store with vectors             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  embeddings STORE                       â”‚
    â”‚  â”œâ”€ id: "uuid-emb-1"                   â”‚
    â”‚  â”œâ”€ documentId: "uuid-doc-1"           â”‚
    â”‚  â”œâ”€ chunkIndex: 0                      â”‚
    â”‚  â”œâ”€ text: "Code_Equip: EQ001..."       â”‚
    â”‚  â”œâ”€ embedding: [0.12, -0.45, ...]     â”‚
    â”‚  â””â”€ userId: "user-123"                 â”‚
    â”‚  ...                                   â”‚
    â”‚  id: "uuid-emb-10"                     â”‚
    â”‚  chunkIndex: 9                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  documents STORE (FINAL)                â”‚
    â”‚  â”œâ”€ id: "uuid-doc-1"                   â”‚
    â”‚  â”œâ”€ processed: true âœ“                  â”‚
    â”‚  â””â”€ (embeddings created)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            RÃ‰SULTAT FINAL
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ… 1 document
    âœ… 1 equipment record
    âœ… 10 embeddings (chunks)
    âœ… PrÃªt pour chatbot + PDR pages
```

---

## Cas d'usage : Affichage page PDR

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PDR Page Request        â”‚
â”‚  app/home/pdr/page.tsx   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query IndexedDB                         â”‚
â”‚  storage.getEquipment(userId)            â”‚
â”‚  storage.getMaintenanceRecords(userId)   â”‚
â”‚  storage.getParts(userId)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch Results                   â”‚
â”‚  â”œâ”€ 5 equipment records          â”‚
â”‚  â”œâ”€ 3 maintenance records        â”‚
â”‚  â””â”€ 8 parts records              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render Tables               â”‚
â”‚  â”œâ”€ Table Ã‰quipements        â”‚
â”‚  â”œâ”€ Table Maintenance        â”‚
â”‚  â””â”€ Table PiÃ¨ces (PDR)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cas d'usage : RAG Chatbot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Chat Query             â”‚
â”‚  "Quel est le modÃ¨le du      â”‚
â”‚   compresseur de l'usine?"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Embed user query (Cohere)  â”‚
â”‚  embedding = [0.34, -0.12...] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Search embeddings STORE         â”‚
â”‚  Cosine similarity search           â”‚
â”‚  Top 3 matches from embeddings:     â”‚
â”‚  â”œâ”€ chunk: "Code_Equip: EQ001..."  â”‚
â”‚  â”‚  score: 0.92 âœ“                  â”‚
â”‚  â”œâ”€ chunk: "Type: Industriel..."   â”‚
â”‚  â”‚  score: 0.88                    â”‚
â”‚  â””â”€ chunk: "Modele: CAT-5000..."   â”‚
â”‚     score: 0.85 âœ“                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Retrieve source documents  â”‚
â”‚  Get documents by documentId   â”‚
â”‚  â”œâ”€ doc1 textContent           â”‚
â”‚  â””â”€ doc2 textContent           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Call LLM with context    â”‚
â”‚  gemini.generate({            â”‚
â”‚    query: "Quel est...",       â”‚
â”‚    context: "Code_Equip..."    â”‚
â”‚  })                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Return Answer            â”‚
â”‚  "ModÃ¨le: CAT-5000,          â”‚
â”‚   Code: EQ001, Type: Indus.  â”‚
â”‚   Source: equipment.pdf"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Structure des donnÃ©es : Exemple visuel

### Equipment Record (aprÃ¨s parsing)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ equipment Store Record              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "a1b2c3d4-..."                  â”‚
â”‚ userId: "user-123"                  â”‚
â”‚ source_document_id: "doc-uuid"      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code_Equip: "EQ001"                 â”‚
â”‚ Nom_Equipement: "Compresseur Air"   â”‚
â”‚ Type: "Centrifuge"                  â”‚
â”‚ Site: "Usine Nord"                  â”‚
â”‚ Marque: "Kaeser"                    â”‚
â”‚ Modele: "CSD 102"                   â”‚
â”‚ Num_Serie: "K-2024-5500"            â”‚
â”‚ Annee_Service: "2019"               â”‚
â”‚ Statut: "Actif"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Maintenance Record (aprÃ¨s parsing)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ maintenance Store Record            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "x9y8z7w6-..."                  â”‚
â”‚ userId: "user-123"                  â”‚
â”‚ source_document_id: "doc-uuid"      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code_Maintenance: "MAINT-2024-001"  â”‚
â”‚ Code_Equip: "EQ001"                 â”‚
â”‚ Date_Intervention: "2024-11-04"     â”‚
â”‚ Type_Maintenance: "PrÃ©ventive"      â”‚
â”‚ Duree_Heures: "4.5"                 â”‚
â”‚ Technicien: "Jean Dupont"           â”‚
â”‚ Piece_Remplacee: "Filtre Air"       â”‚
â”‚ Cout: "250.00 EUR"                  â”‚
â”‚ Commentaire: "Remplacement filtre"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Parts/PDR Record (aprÃ¨s parsing)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ parts Store Record                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "p1p2p3p4-..."                  â”‚
â”‚ userId: "user-123"                  â”‚
â”‚ source_document_id: "doc-uuid"      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code_Piece: "P-AIR-FILTER-001"      â”‚
â”‚ Nom_Piece: "Filtre Air Secondaire"  â”‚
â”‚ Reference: "CSA-5500-0001"          â”‚
â”‚ Quantite_Stock: "12"                â”‚
â”‚ Fournisseur: "Kaeser France"        â”‚
â”‚ Prix_Unitaire: "45.50 EUR"          â”‚
â”‚ Delai_Livraison_Jours: "3"          â”‚
â”‚ Date_Mise_A_Jour: "2024-11-04"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Limitation de taille

```
IndexedDB Storage Limits (Chrome/Firefox)

Total per origin: ~50 MB
Per store: No specific limit

Example breakdown:
â”œâ”€ documents (10 files Ã— 500KB avg) â‰ˆ 5 MB
â”œâ”€ embeddings (100 chunks Ã— 2KB) â‰ˆ 200 KB
â”œâ”€ equipment (100 records Ã— 1KB) â‰ˆ 100 KB
â”œâ”€ maintenance (50 records Ã— 1KB) â‰ˆ 50 KB
â”œâ”€ parts (200 records Ã— 1KB) â‰ˆ 200 KB
â””â”€ chat_history (1000 messages Ã— 0.5KB) â‰ˆ 500 KB

Total â‰ˆ 6 MB (trÃ¨s en-dessous du limite)
```

---

## Ã‰volution possible

```
CURRENT (Client-only)
    â””â”€ IndexedDB
        â”œâ”€ documents
        â”œâ”€ equipment/maintenance/parts
        â””â”€ embeddings

FUTURE (Optional Sync)
    â”œâ”€ IndexedDB (Client)
    â”‚   â””â”€ [Same as above]
    â””â”€ Supabase (Cloud)
        â”œâ”€ equipment table
        â”œâ”€ maintenance table
        â”œâ”€ parts table
        â”œâ”€ documents table
        â””â”€ embeddings table

Sync strategy:
- Auto-sync after processing âœ“
- Conflict resolution (local priority)
- Offline-first, cloud fallback
```

---

## Commandes Debug

```javascript
// VÃ©rifier ce qui est stockÃ©
await window.__GMAO_DEBUG__.documents("USER_ID")
await window.__GMAO_DEBUG__.records("USER_ID")
await window.__GMAO_DEBUG__.content("USER_ID", "DOC_ID")

// AccÃ¨s direct IndexedDB
F12 â†’ Application â†’ IndexedDB â†’ gmao_client_db â†’ [Store]

// Export en JSON
const docs = await storage.getDocuments()
const equipment = await storage.getEquipment(userId)
console.log(JSON.stringify({docs, equipment}, null, 2))
```

---

## RÃ©capitulatif

| Aspect | DÃ©tail |
|--------|--------|
| **Localisation** | IndexedDB (navigateur client) |
| **Persistance** | Jusqu'Ã  suppression donnÃ©es navigateur |
| **Limite taille** | ~50 MB par domaine |
| **SÃ©curitÃ©** | Local = PrivÃ©, aucun envoi Supabase |
| **Vitesse** | TrÃ¨s rapide (accÃ¨s disque client) |
| **Sync** | Aucun (optionnel avec Supabase) |
| **Cas d'usage** | RAG (embeddings) + PDR/RPN (tables) |
| **Backup** | Manuel (export JSON) |
| **Multi-device** | Non supportÃ© (spÃ©cifique navigateur) |

